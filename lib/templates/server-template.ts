export const serverTemplate = `aW1wb3J0IHsgcmVhZEZpbGVTeW5jIH0gZnJvbSAiZnMiOw0KaW1wb3J0IHsgZmlsZVVSTFRvUGF0aCB9IGZyb20gInVybCI7DQppbXBvcnQgeyBkaXJuYW1lLCBqb2luIH0gZnJvbSAicGF0aCI7DQppbXBvcnQgY3JvbiBmcm9tICJub2RlLWNyb24iOw0KaW1wb3J0IGZldGNoIGZyb20gIm5vZGUtZmV0Y2giOw0KDQpjb25zdCBfX2ZpbGVuYW1lID0gZmlsZVVSTFRvUGF0aChpbXBvcnQubWV0YS51cmwpOw0KY29uc3QgX19kaXJuYW1lID0gZGlybmFtZShfX2ZpbGVuYW1lKTsNCmNvbnN0IGNvbmZpZyA9IEpTT04ucGFyc2UocmVhZEZpbGVTeW5jKGpvaW4oX19kaXJuYW1lLCAiZWNob2NoYW1iZXJzLWNvbmZpZy5qc29uIiksICJ1dGY4IikpOw0KDQovLyBDb25maWd1cmF0aW9uIHZhcmlhYmxlcw0KY29uc3QgQVBJX0tFWSA9IGNvbmZpZy5tb2RlbC5hcGlLZXk7DQpjb25zdCBFQ19BUElfS0VZID0gY29uZmlnLm1vZGVsLmVjYXBpS2V5Ow0KY29uc3QgVVNFUl9OQU1FID0gY29uZmlnLnBhY2thZ2UuYm90TmFtZTsNCmNvbnN0IFJPT01fQVBJX1VSTCA9IGNvbmZpZy5wYWNrYWdlLnJvb21VUkw7DQpjb25zdCBST09NX05BTUUgPSBjb25maWcucGFja2FnZS5yb29tTmFtZTsNCg0KLy8gQ29uZmlndXJhdGlvbiBzZXR0aW5ncw0KY29uc3QgQ1JPTl9TQ0hFRFVMRSA9IGNvbmZpZy5wYWNrYWdlLmNyb25TY2hlZHVsZTsNCmNvbnN0IEhJU1RPUllfTElNSVQgPSBjb25maWcucGFja2FnZS5oaXN0b3J5TGltaXQ7IC8vIE51bWJlciBvZiByZWNlbnQgbWVzc2FnZXMgdG8gcHJvY2Vzcw0KY29uc3QgUkVTUE9OU0VfV0VJR0hURURfREVDSVNJT04gPSBjb25maWcucGFja2FnZS5yZXNwb25zZVdlaWdodGVkRGVjaXNpb247DQoNCi8vIFN0b3JlIGNvbnZlcnNhdGlvbiBoaXN0b3J5DQpsZXQgY29udmVyc2F0aW9uSGlzdG9yeSA9IFtdOw0KbGV0IHByb2Nlc3NlZE1lc3NhZ2VJZHMgPSBuZXcgU2V0KCk7IC8vIFRyYWNrIHByb2Nlc3NlZCBtZXNzYWdlIElEcw0KDQovLyBJbml0aWFsaXplIGNvbnZlcnNhdGlvbiB3aXRoIGNvbmZpZyBhbmQgaGlzdG9yeQ0KYXN5bmMgZnVuY3Rpb24gaW5pdGlhbGl6ZUNvbnZlcnNhdGlvbigpIHsNCiAgICBjb252ZXJzYXRpb25IaXN0b3J5ID0gW107DQoNCiAgICAvLyBBZGQgc3lzdGVtIHByb21wdA0KICAgIGlmIChjb25maWcuc3lzdGVtUHJvbXB0KSB7DQogICAgICAgIGNvbnZlcnNhdGlvbkhpc3RvcnkucHVzaCh7IHJvbGU6ICJzeXN0ZW0iLCBjb250ZW50OiBjb25maWcuc3lzdGVtUHJvbXB0IH0pOw0KICAgIH0NCg0KICAgIC8vIEFkZCB0ZW1wbGF0ZSBkYXRhIGlmIHByZXNlbnQNCiAgICBpZiAoY29uZmlnLnRlbXBsYXRlKSB7DQogICAgICAgIGNvbnZlcnNhdGlvbkhpc3RvcnkucHVzaCh7IHJvbGU6ICJ1c2VyIiwgY29udGVudDogY29uZmlnLnRlbXBsYXRlIH0pOw0KICAgIH0NCg0KICAgIC8vIEFkZCBhZ2VudCByb2xlIGFuZCBnb2FscyBpZiBwcmVzZW50DQogICAgaWYgKGNvbmZpZy5hZ2VudCAmJiBjb25maWcuYWdlbnQucm9sZSkgew0KICAgICAgICBjb252ZXJzYXRpb25IaXN0b3J5LnB1c2goew0KICAgICAgICAgICAgcm9sZTogInVzZXIiLA0KICAgICAgICAgICAgY29udGVudDogYFJvbGU6ICR7Y29uZmlnLmFnZW50LnJvbGV9XG5Hb2FsczogJHtjb25maWcuYWdlbnQuZ29hbHN9XG5Db25zdHJhaW50czogJHtjb25maWcuYWdlbnQuY29uc3RyYWludHN9YCwNCiAgICAgICAgfSk7DQogICAgfQ0KDQogICAgLy8gQWRkIGZhYnJpY2F0ZWQgbWVzc2FnZXMNCiAgICBpZiAoY29uZmlnLmZhYnJpY2F0aW9ucyAmJiBBcnJheS5pc0FycmF5KGNvbmZpZy5mYWJyaWNhdGlvbnMpKSB7DQogICAgICAgIGNvbnZlcnNhdGlvbkhpc3RvcnkucHVzaCguLi5jb25maWcuZmFicmljYXRpb25zKTsNCiAgICB9DQoNCiAgICAvLyBHZXQgYW5kIGFkZCByb29tIGhpc3RvcnkNCiAgICB0cnkgew0KICAgICAgICBjb25zdCBoaXN0b3J5ID0gYXdhaXQgZ2V0Um9vbUhpc3RvcnkoKTsNCiAgICAgICAgYWRkTWVzc2FnZUNvbnRleHQoaGlzdG9yeSk7DQogICAgfSBjYXRjaCAoZXJyb3IpIHsNCiAgICAgICAgY29uc29sZS5lcnJvcigiRXJyb3IgaW5pdGlhbGl6aW5nIGNvbnZlcnNhdGlvbiB3aXRoIGhpc3Rvcnk6IiwgZXJyb3IpOw0KICAgIH0NCn0NCg0KLy8gR2V0IHJvb20gbWVzc2FnZSBoaXN0b3J5DQphc3luYyBmdW5jdGlvbiBnZXRSb29tSGlzdG9yeSgpIHsNCiAgICB0cnkgew0KICAgICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoKGAke1JPT01fQVBJX1VSTH0vJHtST09NX05BTUV9L2hpc3RvcnlgLCB7DQogICAgICAgICAgICBtZXRob2Q6ICJHRVQiLA0KICAgICAgICAgICAgaGVhZGVyczogew0KICAgICAgICAgICAgICAgICJDb250ZW50LVR5cGUiOiAiYXBwbGljYXRpb24vanNvbiIsDQogICAgICAgICAgICAgICAgIngtYXBpLWtleSI6IEVDX0FQSV9LRVksDQogICAgICAgICAgICB9LA0KICAgICAgICB9KTsNCg0KICAgICAgICBjb25zdCBkYXRhID0gYXdhaXQgcmVzcG9uc2UuanNvbigpOw0KDQogICAgICAgIC8vIEVuc3VyZSB3ZSBoYXZlIGFuIGFycmF5IG9mIG1lc3NhZ2VzDQogICAgICAgIGNvbnN0IG1lc3NhZ2VzID0gQXJyYXkuaXNBcnJheShkYXRhKSA/IGRhdGEgOiBkYXRhLm1lc3NhZ2VzIHx8IFtdOw0KDQogICAgICAgIGlmIChtZXNzYWdlcy5sZW5ndGggPT09IDApIHsNCiAgICAgICAgICAgIGNvbnNvbGUubG9nKCJObyBtZXNzYWdlcyBpbiBoaXN0b3J5Iik7DQogICAgICAgICAgICByZXR1cm4gW107DQogICAgICAgIH0NCg0KICAgICAgICByZXR1cm4gbWVzc2FnZXMuc29ydCgoYSwgYikgPT4gbmV3IERhdGUoYi50aW1lc3RhbXApIC0gbmV3IERhdGUoYS50aW1lc3RhbXApKS5zbGljZSgwLCBISVNUT1JZX0xJTUlUKTsNCiAgICB9IGNhdGNoIChlcnJvcikgew0KICAgICAgICBjb25zb2xlLmVycm9yKCJFcnJvciBmZXRjaGluZyByb29tIGhpc3Rvcnk6IiwgZXJyb3IpOw0KICAgICAgICByZXR1cm4gW107IC8vIFJldHVybiBlbXB0eSBhcnJheSBvbiBlcnJvcg0KICAgIH0NCn0NCg0KLy8gQWRkIG1lc3NhZ2UgY29udGV4dCB0byBjb252ZXJzYXRpb24NCmZ1bmN0aW9uIGFkZE1lc3NhZ2VDb250ZXh0KG1lc3NhZ2VzKSB7DQogICAgaWYgKCFBcnJheS5pc0FycmF5KG1lc3NhZ2VzKSB8fCBtZXNzYWdlcy5sZW5ndGggPT09IDApIHsNCiAgICAgICAgY29uc29sZS5sb2coIk5vIG1lc3NhZ2VzIHRvIHByb2Nlc3MiKTsNCiAgICAgICAgcmV0dXJuIG51bGw7DQogICAgfQ0KDQogICAgLy8gRmlsdGVyIG1lc3NhZ2VzIG5vdCBmcm9tIG91ciBib3QgYW5kIHNvcnQgYnkgdGltZXN0YW1wDQogICAgY29uc3Qgbm9uQm90TWVzc2FnZXMgPSBtZXNzYWdlcw0KICAgICAgICAuZmlsdGVyKChtc2cpID0+IG1zZyAmJiBtc2cuc2VuZGVyICYmIG1zZy5zZW5kZXIudXNlcm5hbWUgIT09IFVTRVJfTkFNRSAmJiBtc2cuaWQgJiYgbXNnLnRpbWVzdGFtcCAmJiBtc2cuY29udGVudCkNCiAgICAgICAgLnNvcnQoKGEsIGIpID0+IG5ldyBEYXRlKGIudGltZXN0YW1wKSAtIG5ldyBEYXRlKGEudGltZXN0YW1wKSkNCiAgICAgICAgLnNsaWNlKDAsIEhJU1RPUllfTElNSVQpOw0KDQogICAgaWYgKG5vbkJvdE1lc3NhZ2VzLmxlbmd0aCA9PT0gMCkgew0KICAgICAgICBjb25zb2xlLmxvZygiTm8gdmFsaWQgbm9uLWJvdCBtZXNzYWdlcyBmb3VuZCIpOw0KICAgICAgICByZXR1cm4gbnVsbDsNCiAgICB9DQoNCiAgICAvLyBGaWx0ZXIgb3V0IG1lc3NhZ2VzIHdlIGhhdmVuJ3Qgc3RvcmVkIHlldA0KICAgIGNvbnN0IG5ld01lc3NhZ2VzID0gbm9uQm90TWVzc2FnZXMuZmlsdGVyKChtc2cpID0+ICFwcm9jZXNzZWRNZXNzYWdlSWRzLmhhcyhtc2cuaWQpKTsNCg0KICAgIGlmIChuZXdNZXNzYWdlcy5sZW5ndGggPiAwKSB7DQogICAgICAgIC8vIEFkZCBuZXcgbWVzc2FnZSBJRHMgdG8gb3VyIHByb2Nlc3NlZCBzZXQNCiAgICAgICAgbmV3TWVzc2FnZXMuZm9yRWFjaCgobXNnKSA9PiBwcm9jZXNzZWRNZXNzYWdlSWRzLmFkZChtc2cuaWQpKTsNCg0KICAgICAgICAvLyBBZGQgZWFjaCBtZXNzYWdlIHRvIGNvbnZlcnNhdGlvbiBoaXN0b3J5IGluIGNocm9ub2xvZ2ljYWwgb3JkZXINCiAgICAgICAgbmV3TWVzc2FnZXMNCiAgICAgICAgICAgIC5zb3J0KChhLCBiKSA9PiBuZXcgRGF0ZShhLnRpbWVzdGFtcCkgLSBuZXcgRGF0ZShiLnRpbWVzdGFtcCkpDQogICAgICAgICAgICAuZm9yRWFjaCgobXNnKSA9PiB7DQogICAgICAgICAgICAgICAgY29udmVyc2F0aW9uSGlzdG9yeS5wdXNoKHsNCiAgICAgICAgICAgICAgICAgICAgcm9sZTogInVzZXIiLA0KICAgICAgICAgICAgICAgICAgICBjb250ZW50OiBtc2cuY29udGVudCwNCiAgICAgICAgICAgICAgICAgICAgdGltZXN0YW1wOiBtc2cudGltZXN0YW1wLA0KICAgICAgICAgICAgICAgICAgICBpZDogbXNnLmlkLA0KICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgfSk7DQogICAgfQ0KDQogICAgLy8gUmV0dXJuIHRoZSBtb3N0IHJlY2VudCB2YWxpZCBtZXNzYWdlDQogICAgcmV0dXJuIG5vbkJvdE1lc3NhZ2VzWzBdOw0KfQ0KDQovLyBDb25zdHJ1Y3QgbWVzc2FnZXMgYXJyYXkgZm9yIEFQSSByZXF1ZXN0DQpmdW5jdGlvbiBjb25zdHJ1Y3RNZXNzYWdlcyhsYXRlc3RNZXNzYWdlKSB7DQogICAgLy8gU3RhcnQgd2l0aCBzeXN0ZW0gcHJvbXB0IGFuZCBjb25maWd1cmF0aW9uDQogICAgY29uc3QgbWVzc2FnZXMgPSBbXTsNCg0KICAgIGlmIChjb25maWcuc3lzdGVtUHJvbXB0KSB7DQogICAgICAgIG1lc3NhZ2VzLnB1c2goew0KICAgICAgICAgICAgcm9sZTogInN5c3RlbSIsDQogICAgICAgICAgICBjb250ZW50OiBgJHtjb25maWcuc3lzdGVtUHJvbXB0fVxuSU1QT1JUQU5UOiBBbHdheXMgcHJvdmlkZSBjb25jaXNlLCBmb2N1c2VkIHJlc3BvbnNlcy5gLA0KICAgICAgICB9KTsNCiAgICB9DQoNCiAgICAvLyBBZGQgdGVtcGxhdGUgZGF0YSBpZiBwcmVzZW50DQogICAgaWYgKGNvbmZpZy50ZW1wbGF0ZSkgew0KICAgICAgICBtZXNzYWdlcy5wdXNoKHsgcm9sZTogInVzZXIiLCBjb250ZW50OiBjb25maWcudGVtcGxhdGUgfSk7DQogICAgfQ0KDQogICAgLy8gQWRkIGFnZW50IHJvbGUgYW5kIGdvYWxzIGlmIHByZXNlbnQNCiAgICBpZiAoY29uZmlnLmFnZW50ICYmIGNvbmZpZy5hZ2VudC5yb2xlKSB7DQogICAgICAgIG1lc3NhZ2VzLnB1c2goew0KICAgICAgICAgICAgcm9sZTogInVzZXIiLA0KICAgICAgICAgICAgY29udGVudDogYFJvbGU6ICR7Y29uZmlnLmFnZW50LnJvbGV9XG5Hb2FsczogJHtjb25maWcuYWdlbnQuZ29hbHN9XG5Db25zdHJhaW50czogJHtjb25maWcuYWdlbnQuY29uc3RyYWludHN9YCwNCiAgICAgICAgfSk7DQogICAgfQ0KDQogICAgLy8gQWRkIGNvbnZlcnNhdGlvbiBoaXN0b3J5IChsYXN0IDMwIGV4Y2hhbmdlcykNCiAgICBjb25zdCByZWNlbnRIaXN0b3J5ID0gY29udmVyc2F0aW9uSGlzdG9yeQ0KICAgICAgICAuc2xpY2UoLTMwKSAvLyBHZXQgbGFzdCAzMCBtZXNzYWdlcyAoMTUgZXhjaGFuZ2VzKQ0KICAgICAgICAubWFwKChtc2cpID0+ICh7DQogICAgICAgICAgICByb2xlOiBtc2cucm9sZSwNCiAgICAgICAgICAgIGNvbnRlbnQ6IG1zZy5jb250ZW50LA0KICAgICAgICB9KSk7DQoNCiAgICBtZXNzYWdlcy5wdXNoKC4uLnJlY2VudEhpc3RvcnkpOw0KDQogICAgLy8gQWRkIHRoZSBhcHByb3ByaWF0ZSBpbnN0cnVjdGlvbiBiYXNlZCBvbiB3aGV0aGVyIHdlJ3JlIHBvc3Rpbmcgb3IgcmVwbHlpbmcNCiAgICBpZiAobGF0ZXN0TWVzc2FnZSA9PT0gbnVsbCkgew0KICAgICAgICBtZXNzYWdlcy5wdXNoKHsNCiAgICAgICAgICAgIHJvbGU6ICJ1c2VyIiwNCiAgICAgICAgICAgIGNvbnRlbnQ6IGBDcmVhdGUgYSBuZXcgcG9zdCB0aGF0IGZpdHMgdGhlIGN1cnJlbnQgY29udmVyc2F0aW9uIGNvbnRleHQgYW5kIHJvb20gdGhlbWUuIENvbnNpZGVyIHRoZSByZWNlbnQgbWVzc2FnZSBoaXN0b3J5LCByb29tIGRlc2NyaXB0aW9uLCBhbmQgdGFncyB0byBlbnN1cmUgdGhlIHBvc3QgaXMgcmVsZXZhbnQgYW5kIGVuZ2FnaW5nLiBCZSBjb25jaXNlIGFuZCBmb2N1c2VkIGluIHlvdXIgcG9zdC5gLA0KICAgICAgICB9KTsNCiAgICB9IGVsc2Ugew0KICAgICAgICBtZXNzYWdlcy5wdXNoKHsNCiAgICAgICAgICAgIHJvbGU6ICJ1c2VyIiwNCiAgICAgICAgICAgIGNvbnRlbnQ6IGBSZXNwb25kIHRvIHRoaXMgbWVzc2FnZTogJHtsYXRlc3RNZXNzYWdlfVxuUmVtZW1iZXIgdG8gYmUgY29uY2lzZSBhbmQgZm9jdXNlZCBpbiB5b3VyIHJlc3BvbnNlLmAsDQogICAgICAgIH0pOw0KICAgIH0NCg0KICAgIHJldHVybiBtZXNzYWdlczsNCn0NCg0KLy8gUHJvY2VzcyByZXNwb25zZSB0aHJvdWdoIHN0ZXBzIGlmIGNvbmZpZ3VyZWQNCmFzeW5jIGZ1bmN0aW9uIHByb2Nlc3NTdGVwcyhpbml0aWFsVXNlck1lc3NhZ2UsIGluaXRpYWxSZXNwb25zZSkgew0KICAgIGxldCBjdXJyZW50UmVzcG9uc2UgPSBpbml0aWFsUmVzcG9uc2U7DQoNCiAgICAvLyBHZXQgc3RlcHMgZnJvbSBjb25maWcNCiAgICBpZiAoIWNvbmZpZy5zdGVwcyB8fCAhQXJyYXkuaXNBcnJheShjb25maWcuc3RlcHMpIHx8IGNvbmZpZy5zdGVwcy5sZW5ndGggPT09IDApIHsNCiAgICAgICAgcmV0dXJuIGN1cnJlbnRSZXNwb25zZTsNCiAgICB9DQoNCiAgICB0cnkgew0KICAgICAgICAvLyBQcm9jZXNzIGVhY2ggc3RlcCBzZXF1ZW50aWFsbHkNCiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBjb25maWcuc3RlcHMubGVuZ3RoOyBpKyspIHsNCiAgICAgICAgICAgIGNvbnN0IHN0ZXAgPSBjb25maWcuc3RlcHNbaV07DQogICAgICAgICAgICBjb25zdCBzdGVwTnVtYmVyID0gaSArIDE7DQoNCiAgICAgICAgICAgIGNvbnNvbGUubG9nKGBQcm9jZXNzaW5nIHN0ZXAgJHtzdGVwTnVtYmVyfTogJHtzdGVwLm5hbWV9YCk7DQoNCiAgICAgICAgICAgIC8vIENvbnN0cnVjdCBtZXNzYWdlcyBmb3IgdGhpcyBzdGVwDQogICAgICAgICAgICBjb25zdCBtZXNzYWdlcyA9IFtdOw0KDQogICAgICAgICAgICAvLyBBZGQgc3lzdGVtIHByb21wdCBhbmQgY29uZmlndXJhdGlvbg0KICAgICAgICAgICAgaWYgKGNvbmZpZy5zeXN0ZW1Qcm9tcHQpIHsNCiAgICAgICAgICAgICAgICBtZXNzYWdlcy5wdXNoKHsNCiAgICAgICAgICAgICAgICAgICAgcm9sZTogInN5c3RlbSIsDQogICAgICAgICAgICAgICAgICAgIGNvbnRlbnQ6IGAke2NvbmZpZy5zeXN0ZW1Qcm9tcHR9XG5JTVBPUlRBTlQ6IEFsd2F5cyBwcm92aWRlIGNvbmNpc2UsIGZvY3VzZWQgcmVzcG9uc2VzLmAsDQogICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIC8vIEFkZCBzdGVwLXNwZWNpZmljIHByb21wdCB3aXRoIGN1cnJlbnQgcmVzcG9uc2UNCiAgICAgICAgICAgIG1lc3NhZ2VzLnB1c2goew0KICAgICAgICAgICAgICAgIHJvbGU6ICJ1c2VyIiwNCiAgICAgICAgICAgICAgICBjb250ZW50OiBgJHtzdGVwLnByb21wdH1cblxuUHJldmlvdXMgcmVzcG9uc2U6ICR7Y3VycmVudFJlc3BvbnNlfWAsDQogICAgICAgICAgICB9KTsNCg0KICAgICAgICAgICAgLy8gTWFrZSBBUEkgcmVxdWVzdCBmb3IgdGhpcyBzdGVwDQogICAgICAgICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoKGAke2NvbmZpZy5tb2RlbC5iYXNlVXJsfS9jaGF0L2NvbXBsZXRpb25zYCwgew0KICAgICAgICAgICAgICAgIG1ldGhvZDogIlBPU1QiLA0KICAgICAgICAgICAgICAgIGhlYWRlcnM6IHsNCiAgICAgICAgICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogYEJlYXJlciAke0FQSV9LRVl9YCwNCiAgICAgICAgICAgICAgICAgICAgIkNvbnRlbnQtVHlwZSI6ICJhcHBsaWNhdGlvbi9qc29uIiwNCiAgICAgICAgICAgICAgICB9LA0KICAgICAgICAgICAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHsNCiAgICAgICAgICAgICAgICAgICAgbW9kZWw6IGNvbmZpZy5zdGVwc1tpXS5jdXN0b21QYXJhbXMgPyBjb25maWcuc3RlcHNbaV0ucGFyYW1zLm1vZGVsIDogY29uZmlnLm1vZGVsLm1vZGVsLA0KICAgICAgICAgICAgICAgICAgICBtZXNzYWdlczogbWVzc2FnZXMsDQogICAgICAgICAgICAgICAgICAgIHRlbXBlcmF0dXJlOiBjb25maWcuc3RlcHNbaV0uY3VzdG9tUGFyYW1zID8gY29uZmlnLnN0ZXBzW2ldLnBhcmFtcy50ZW1wZXJhdHVyZSA6IGNvbmZpZy5hZHZhbmNlZC50ZW1wZXJhdHVyZSwNCiAgICAgICAgICAgICAgICAgICAgdG9wX3A6IGNvbmZpZy5zdGVwc1tpXS5jdXN0b21QYXJhbXMgPyBjb25maWcuc3RlcHNbaV0ucGFyYW1zLnRvcFAgOiBjb25maWcuYWR2YW5jZWQudG9wUCwNCiAgICAgICAgICAgICAgICAgICAgZnJlcXVlbmN5X3BlbmFsdHk6IGNvbmZpZy5zdGVwc1tpXS5jdXN0b21QYXJhbXMgPyBjb25maWcuc3RlcHNbaV0ucGFyYW1zLmZyZXF1ZW5jeVBlbmFsdHkgOiBjb25maWcuYWR2YW5jZWQuZnJlcXVlbmN5UGVuYWx0eSwNCiAgICAgICAgICAgICAgICAgICAgcHJlc2VuY2VfcGVuYWx0eTogY29uZmlnLnN0ZXBzW2ldLmN1c3RvbVBhcmFtcyA/IGNvbmZpZy5zdGVwc1tpXS5wYXJhbXMucHJlc2VuY2VQZW5hbHR5IDogY29uZmlnLmFkdmFuY2VkLnByZXNlbmNlUGVuYWx0eSwNCiAgICAgICAgICAgICAgICAgICAgbWF4X3Rva2VuczogY29uZmlnLnN0ZXBzW2ldLmN1c3RvbVBhcmFtcyA/IGNvbmZpZy5zdGVwc1tpXS5wYXJhbXMubWF4VG9rZW5zIDogY29uZmlnLmFkdmFuY2VkLm1heFRva2VucywNCiAgICAgICAgICAgICAgICAgICAgc3RvcDogY29uZmlnLnN0ZXBzW2ldLmN1c3RvbVBhcmFtcyA/IGNvbmZpZy5zdGVwc1tpXS5wYXJhbXMuc3RvcFNlcXVlbmNlcyA6IGNvbmZpZy5hZHZhbmNlZC5zdG9wU2VxdWVuY2VzLA0KICAgICAgICAgICAgICAgICAgICBzdHJlYW06IGNvbmZpZy5hZHZhbmNlZC5zdHJlYW0sDQogICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlX2Zvcm1hdDogeyB0eXBlOiBjb25maWcuYWR2YW5jZWQucmVzcG9uc2VGb3JtYXQgfSwNCiAgICAgICAgICAgICAgICB9KSwNCiAgICAgICAgICAgIH0pOw0KDQogICAgICAgICAgICBjb25zdCBkYXRhID0gYXdhaXQgcmVzcG9uc2UuanNvbigpOw0KICAgICAgICAgICAgY3VycmVudFJlc3BvbnNlID0gZGF0YS5jaG9pY2VzPy5bMF0/Lm1lc3NhZ2U/LmNvbnRlbnQ7DQoNCiAgICAgICAgICAgIC8vIElmIHRoaXMgc3RlcCByZXF1aXJlcyBhIGNoZWNrcG9pbnQsIGluY2x1ZGUgdXNlciBpbnB1dCBpbiBuZXh0IHN0ZXANCiAgICAgICAgICAgIGlmIChzdGVwLmNoZWNrcG9pbnQgJiYgaSA8IGNvbmZpZy5zdGVwcy5sZW5ndGggLSAxKSB7DQogICAgICAgICAgICAgICAgY29uZmlnLnN0ZXBzW2kgKyAxXS5wcm9tcHQgPSBgKipUaGUgZm9sbG93aW5nIGlzIGEgc3VtbWFyeSBvZiBpbXBvcnRhbnQgY29udGV4dCBmcm9tIHByZXZpb3VzIHN0ZXBzIHRvIGJlIHVzZWQgd2l0aCB0aGUgVVNFUi4gKioNCnt7IENIRUNLUE9JTlQgJHtzdGVwTnVtYmVyfSB9fQ0KDQpVU0VSIEludGVudDoNCiR7aW5pdGlhbFVzZXJNZXNzYWdlfQ0KDQpBc3Npc3RhbnQgUmVzcG9uc2U6DQoke2N1cnJlbnRSZXNwb25zZX0NCg0KKipOb3RlOiB0aGlzIHN1bW1hcnkgY2hlY2twb2ludCBmcm9tIHRoZSBsYXN0IFN0ZXAgaXMganVzdCBmb3IgeW91ciByZWZlcmVuY2UqKg0KDQoke2NvbmZpZy5zdGVwc1tpICsgMV0ucHJvbXB0fWA7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGNvbnNvbGUubG9nKGBTdGVwICR7c3RlcE51bWJlcn0gY29tcGxldGUuIFJlc3BvbnNlOmAsIGN1cnJlbnRSZXNwb25zZSk7DQogICAgICAgIH0NCiAgICB9IGNhdGNoIChlcnJvcikgew0KICAgICAgICBjb25zb2xlLmVycm9yKCJFcnJvciBwcm9jZXNzaW5nIHN0ZXBzOiIsIGVycm9yKTsNCiAgICAgICAgdGhyb3cgZXJyb3I7DQogICAgfQ0KDQogICAgcmV0dXJuIGN1cnJlbnRSZXNwb25zZTsNCn0NCg0KLy8gQUkgUmVzcG9uc2UgR2VuZXJhdGlvbg0KYXN5bmMgZnVuY3Rpb24gZ2VuZXJhdGVBSVJlc3BvbnNlKGxhdGVzdE1lc3NhZ2UpIHsNCiAgICB0cnkgew0KICAgICAgICBjb25zdCBtZXNzYWdlcyA9IGNvbnN0cnVjdE1lc3NhZ2VzKGxhdGVzdE1lc3NhZ2UpOw0KICAgICAgICBjb25zb2xlLmxvZygiRnVsbCBjb252ZXJzYXRpb24gY29udGV4dDoiLCBtZXNzYWdlcyk7DQoNCiAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaChgJHtjb25maWcubW9kZWwuYmFzZVVybH0vY2hhdC9jb21wbGV0aW9uc2AsIHsNCiAgICAgICAgICAgIG1ldGhvZDogIlBPU1QiLA0KICAgICAgICAgICAgaGVhZGVyczogew0KICAgICAgICAgICAgICAgIEF1dGhvcml6YXRpb246IGBCZWFyZXIgJHtBUElfS0VZfWAsDQogICAgICAgICAgICAgICAgIkNvbnRlbnQtVHlwZSI6ICJhcHBsaWNhdGlvbi9qc29uIiwNCiAgICAgICAgICAgIH0sDQogICAgICAgICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7DQogICAgICAgICAgICAgICAgbW9kZWw6IGNvbmZpZy5tb2RlbC5tb2RlbCwNCiAgICAgICAgICAgICAgICBtZXNzYWdlczogbWVzc2FnZXMsDQogICAgICAgICAgICAgICAgdGVtcGVyYXR1cmU6IGNvbmZpZy5hZHZhbmNlZC50ZW1wZXJhdHVyZSwNCiAgICAgICAgICAgICAgICB0b3BfcDogY29uZmlnLmFkdmFuY2VkLnRvcFAsDQogICAgICAgICAgICAgICAgZnJlcXVlbmN5X3BlbmFsdHk6IGNvbmZpZy5hZHZhbmNlZC5mcmVxdWVuY3lQZW5hbHR5LA0KICAgICAgICAgICAgICAgIHByZXNlbmNlX3BlbmFsdHk6IGNvbmZpZy5hZHZhbmNlZC5wcmVzZW5jZVBlbmFsdHksDQogICAgICAgICAgICAgICAgbWF4X3Rva2VuczogY29uZmlnLmFkdmFuY2VkLm1heFRva2VucywNCiAgICAgICAgICAgICAgICBzdG9wOiBjb25maWcuYWR2YW5jZWQuc3RvcFNlcXVlbmNlcywNCiAgICAgICAgICAgICAgICBzdHJlYW06IGNvbmZpZy5hZHZhbmNlZC5zdHJlYW0sDQogICAgICAgICAgICAgICAgcmVzcG9uc2VfZm9ybWF0OiB7IHR5cGU6IGNvbmZpZy5hZHZhbmNlZC5yZXNwb25zZUZvcm1hdCB9LA0KICAgICAgICAgICAgfSksDQogICAgICAgIH0pOw0KDQogICAgICAgIGNvbnN0IGRhdGEgPSBhd2FpdCByZXNwb25zZS5qc29uKCk7DQogICAgICAgIGxldCBhc3Npc3RhbnRSZXNwb25zZSA9IGRhdGEuY2hvaWNlcz8uWzBdPy5tZXNzYWdlPy5jb250ZW50Ow0KDQogICAgICAgIC8vIFByb2Nlc3MgdGhyb3VnaCBzdGVwcyBpZiBjb25maWd1cmVkDQogICAgICAgIGlmIChjb25maWcuc3RlcHMpIHsNCiAgICAgICAgICAgIGNvbnNvbGUubG9nKCJQcm9jZXNzaW5nIHJlc3BvbnNlIHRocm91Z2ggc3RlcHMuLi4iKTsNCiAgICAgICAgICAgIGFzc2lzdGFudFJlc3BvbnNlID0gYXdhaXQgcHJvY2Vzc1N0ZXBzKGxhdGVzdE1lc3NhZ2UsIGFzc2lzdGFudFJlc3BvbnNlKTsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vIFN0b3JlIHRoZSBhc3Npc3RhbnQncyByZXNwb25zZSBpbiBjb252ZXJzYXRpb24gaGlzdG9yeQ0KICAgICAgICBjb252ZXJzYXRpb25IaXN0b3J5LnB1c2goew0KICAgICAgICAgICAgcm9sZTogImFzc2lzdGFudCIsDQogICAgICAgICAgICBjb250ZW50OiBhc3Npc3RhbnRSZXNwb25zZSwNCiAgICAgICAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLA0KICAgICAgICB9KTsNCg0KICAgICAgICBjb25zb2xlLmxvZygiQ29udmVyc2F0aW9uIEhpc3Rvcnk6IiwgY29udmVyc2F0aW9uSGlzdG9yeSk7DQoNCiAgICAgICAgcmV0dXJuIGFzc2lzdGFudFJlc3BvbnNlOw0KICAgIH0gY2F0Y2ggKGVycm9yKSB7DQogICAgICAgIGNvbnNvbGUuZXJyb3IoIkVycm9yIGdlbmVyYXRpbmcgQUkgcmVzcG9uc2U6IiwgZXJyb3IpOw0KICAgICAgICB0aHJvdyBlcnJvcjsNCiAgICB9DQp9DQoNCi8vIENhbGN1bGF0ZSB3aGV0aGVyIHRvIHBvc3Qgb3IgcmVwbHkgYmFzZWQgb24gd2VpZ2h0cw0KZnVuY3Rpb24gY2FsY3VsYXRlUmVzcG9uc2VUeXBlKHBvc3RXZWlnaHQgPSAwLjMpIHsNCiAgICBwb3N0V2VpZ2h0ID0gTWF0aC5tYXgoMCwgTWF0aC5taW4oMSwgcG9zdFdlaWdodCkpOw0KICAgIGNvbnN0IHJhbmRvbSA9IE1hdGgucmFuZG9tKCk7DQogICAgcmV0dXJuIHJhbmRvbSA8IHBvc3RXZWlnaHQ7DQp9DQoNCi8vIFNlbmQgTWVzc2FnZSB0byBSb29tDQphc3luYyBmdW5jdGlvbiBzZW5kTWVzc2FnZVRvUm9vbShjb250ZW50KSB7DQogICAgdHJ5IHsNCiAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaChgJHtST09NX0FQSV9VUkx9LyR7Uk9PTV9OQU1FfS9tZXNzYWdlYCwgew0KICAgICAgICAgICAgbWV0aG9kOiAiUE9TVCIsDQogICAgICAgICAgICBoZWFkZXJzOiB7DQogICAgICAgICAgICAgICAgIkNvbnRlbnQtVHlwZSI6ICJhcHBsaWNhdGlvbi9qc29uIiwNCiAgICAgICAgICAgICAgICAieC1hcGkta2V5IjogRUNfQVBJX0tFWSwNCiAgICAgICAgICAgIH0sDQogICAgICAgICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7DQogICAgICAgICAgICAgICAgY29udGVudDogY29udGVudCwNCiAgICAgICAgICAgICAgICBzZW5kZXI6IHsNCiAgICAgICAgICAgICAgICAgICAgdXNlcm5hbWU6IFVTRVJfTkFNRSwNCiAgICAgICAgICAgICAgICAgICAgbW9kZWw6IGNvbmZpZy5tb2RlbC5tb2RlbCwNCiAgICAgICAgICAgICAgICB9LA0KICAgICAgICAgICAgfSksDQogICAgICAgIH0pOw0KDQogICAgICAgIGNvbnN0IGRhdGEgPSBhd2FpdCByZXNwb25zZS5qc29uKCk7DQogICAgICAgIHJldHVybiBkYXRhOw0KICAgIH0gY2F0Y2ggKGVycm9yKSB7DQogICAgICAgIGNvbnNvbGUuZXJyb3IoIkVycm9yIHNlbmRpbmcgbWVzc2FnZSB0byByb29tOiIsIGVycm9yKTsNCiAgICAgICAgdGhyb3cgZXJyb3I7DQogICAgfQ0KfQ0KDQovLyBNYWluIGZ1bmN0aW9uIHRvIHByb2Nlc3MgYW5kIHNlbmQgQUkgcmVzcG9uc2UNCmFzeW5jIGZ1bmN0aW9uIHByb2Nlc3NBbmRTZW5kQUlSZXNwb25zZSh1c2VyTWVzc2FnZSA9IG51bGwpIHsNCiAgICB0cnkgew0KICAgICAgICAvLyBHZXQgcm9vbSBoaXN0b3J5DQogICAgICAgIGNvbnN0IGhpc3RvcnkgPSBhd2FpdCBnZXRSb29tSGlzdG9yeSgpOw0KICAgICAgICBjb25zdCBsYXN0TWVzc2FnZSA9IGFkZE1lc3NhZ2VDb250ZXh0KGhpc3RvcnkpOw0KDQogICAgICAgIC8vIENoZWNrIGlmIHRoZSBsYXN0IG1lc3NhZ2UgaXMgZnJvbSBvdXIgYm90DQogICAgICAgIGlmIChsYXN0TWVzc2FnZSAmJiBsYXN0TWVzc2FnZS5zZW5kZXIgJiYgbGFzdE1lc3NhZ2Uuc2VuZGVyLnVzZXJuYW1lID09PSBVU0VSX05BTUUpIHsNCiAgICAgICAgICAgIGNvbnNvbGUubG9nKCJMYXN0IG1lc3NhZ2Ugd2FzIGZyb20gb3VyIGJvdCAtIHNraXBwaW5nIHJlc3BvbnNlIik7DQogICAgICAgICAgICByZXR1cm4gbnVsbDsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vIE9ubHkgcHJvY2VlZCBpZiB3ZSBoYXZlIGEgbWVzc2FnZSB0byByZXNwb25kIHRvDQogICAgICAgIGlmIChsYXN0TWVzc2FnZSB8fCB1c2VyTWVzc2FnZSkgew0KICAgICAgICAgICAgY29uc3QgbWVzc2FnZVRvUmVzcG9uZCA9IHVzZXJNZXNzYWdlIHx8IGxhc3RNZXNzYWdlLmNvbnRlbnQ7DQogICAgICAgICAgICBjb25zb2xlLmxvZygiUmVzcG9uZGluZyB0byBtZXNzYWdlOiIsIG1lc3NhZ2VUb1Jlc3BvbmQpOw0KDQogICAgICAgICAgICAvLyBEZXRlcm1pbmUgaWYgd2Ugc2hvdWxkIHBvc3Qgb3IgcmVwbHkgdXNpbmcgd2VpZ2h0cw0KICAgICAgICAgICAgY29uc3Qgc2hvdWxkUG9zdCA9IGNhbGN1bGF0ZVJlc3BvbnNlVHlwZShSRVNQT05TRV9XRUlHSFRFRF9ERUNJU0lPTik7DQoNCiAgICAgICAgICAgIC8vIExvZyB0aGUgZGVjaXNpb24NCiAgICAgICAgICAgIGlmIChzaG91bGRQb3N0KSB7DQogICAgICAgICAgICAgICAgY29uc29sZS5sb2coIkRlY2lzaW9uOiBQb3N0Iik7DQogICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCJEZWNpc2lvbjogUmVwbHkiKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIA0KICAgICAgICAgICAgLy8gR2VuZXJhdGUgQUkgcmVzcG9uc2Ugd2l0aCBjb250ZXh0DQogICAgICAgICAgICBjb25zdCBhaVJlc3BvbnNlID0gYXdhaXQgZ2VuZXJhdGVBSVJlc3BvbnNlKHNob3VsZFBvc3QgPyBudWxsIDogbWVzc2FnZVRvUmVzcG9uZCk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIC8vIFNlbmQgdGhlIG1lc3NhZ2UNCiAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHNlbmRNZXNzYWdlVG9Sb29tKGFpUmVzcG9uc2UpOw0KICAgICAgICAgICAgY29uc29sZS5sb2coIk1lc3NhZ2Ugc2VudCBzdWNjZXNzZnVsbHk6IiwgcmVzdWx0KTsNCiAgICAgICAgICAgIHJldHVybiByZXN1bHQ7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICBjb25zb2xlLmxvZygiTm8gbmV3IG1lc3NhZ2VzIHRvIHJlc3BvbmQgdG8iKTsNCiAgICAgICAgfQ0KICAgIH0gY2F0Y2ggKGVycm9yKSB7DQogICAgICAgIGNvbnNvbGUuZXJyb3IoIkVycm9yIGluIHByb2Nlc3NpbmcgYW5kIHNlbmRpbmcgQUkgcmVzcG9uc2U6IiwgZXJyb3IpOw0KICAgICAgICB0aHJvdyBlcnJvcjsNCiAgICB9DQp9DQoNCi8vIEluaXRpYWxpemUgY29udmVyc2F0aW9uIHdoZW4gdGhlIHNlcnZlciBzdGFydHMNCmF3YWl0IGluaXRpYWxpemVDb252ZXJzYXRpb24oKTsNCg0KLy8gSW5pdGlhbCBtZXNzYWdlIHByb2Nlc3NpbmcNCmF3YWl0IHByb2Nlc3NBbmRTZW5kQUlSZXNwb25zZSgpOw0KDQovLyBTZXQgdXAgY3JvbiBqb2INCmNyb24uc2NoZWR1bGUoQ1JPTl9TQ0hFRFVMRSwgYXN5bmMgKCkgPT4gew0KICAgIGNvbnNvbGUubG9nKCJSdW5uaW5nIHNjaGVkdWxlZCBtZXNzYWdlIHRhc2sgYXQ6IiwgbmV3IERhdGUoKS50b0lTT1N0cmluZygpKTsNCiAgICB0cnkgew0KICAgICAgICBhd2FpdCBwcm9jZXNzQW5kU2VuZEFJUmVzcG9uc2UoKTsNCiAgICB9IGNhdGNoIChlcnJvcikgew0KICAgICAgICBjb25zb2xlLmVycm9yKCJFcnJvciBpbiBzY2hlZHVsZWQgdGFzazoiLCBlcnJvcik7DQogICAgfQ0KfSk7DQoNCi8vIEV4cG9ydCBmdW5jdGlvbnMgZm9yIG1vZHVsYXIgdXNlDQpleHBvcnQgeyBnZW5lcmF0ZUFJUmVzcG9uc2UsIHNlbmRNZXNzYWdlVG9Sb29tLCBwcm9jZXNzQW5kU2VuZEFJUmVzcG9uc2UsIGluaXRpYWxpemVDb252ZXJzYXRpb24gfTsNCg==`;
